#!/usr/bin/env node
const fs = require('fs');
const path = require('path');
const { CommandService, ApplicationCommand } = require('../build')

function checkModuleExists(name) {
    try { return require.resolve(name); }
    catch (error) { return false; }
}

async function bootstrap() {
    const CLI_PATH = process.env.CLI_PATH || 'cli.ts';
    const cli = path.resolve(process.cwd(), CLI_PATH);

    const exists = fs.existsSync(cli);
    if (exists) {
        if (path.extname(cli) === '.ts') {
            checkModuleExists('tsconfig-paths')
                && require('tsconfig-paths').register();
            checkModuleExists('ts-node')
                && require('ts-node').register();
        }
        require(cli);
    } else {
        await new CommandService([
            new ApplicationCommand
        ]).create()
    }
}

bootstrap();
